################################################################################
# Mystic Home Server - Docker Compose Configuration
#
# This file defines the complete infrastructure for a self-hosted home server
# including reverse proxy, file storage, CI/CD, project management, and
# collaboration tools.
#
# BEFORE FIRST RUN:
# 1. Run setup-volumes.sh to create directories with correct permissions
# 2. Create external network: docker network create web
# 3. Change all passwords from default "password" value
# 4. Configure Traefik (create /data/docker/traefik/traefik.toml)
# 5. Set up DNS for *.mystic.home domains
#
# SERVICES:
# - Traefik: Reverse proxy (ports 80, 8080)
# - Nginx Gateway: Landing page (home.mystic.home)
# - Nextcloud: File storage (cloud.mystic.home)
# - Jenkins: CI/CD (jenkins.mystic.home)
# - Bamboo: Build server (bamboo.mystic.home)
# - Confluence: Wiki/docs (confluence.mystic.home)
# - Jira: Issue tracking (jira.mystic.home)
# - Bitbucket: Git repos (bitbucket.mystic.home)
# - Mattermost: Team chat (chat.mystic.home)
# - Mail Server: SMTP/IMAP (mail.mystic.home)
# - Ollama: Local LLM inference (API only)
# - Open WebUI: AI chat interface (ai.mystic.home)
# - Elasticsearch: Search & analytics engine (API only)
# - Logstash: Log ingestion pipeline (API only)
# - Kibana: Log visualization (kibana.mystic.home)
# - MariaDB: Database for Nextcloud
# - PostgreSQL: 5 instances for other services
#
# Author: Developer Agent - Mystic Home Server
# Version: 1.0
################################################################################

services:
  #-----------------------------------------------------------------------------
  # TRAEFIK - Reverse Proxy & SSL Termination
  #-----------------------------------------------------------------------------
  # Routes all HTTP/HTTPS traffic to appropriate services
  # Provides automatic service discovery via Docker labels
  # Dashboard available on port 8080 (WARNING: unsecured by default)
  #-----------------------------------------------------------------------------
  traefik:
    image: traefik:latest
    container_name: traefik
    restart: unless-stopped
    ports:
      - "80:80"       # HTTP entry point
      - "8080:8080"   # Dashboard (WARNING: publicly accessible without auth)
    volumes:
      # Main configuration file (must be created before starting)
      - /data/docker/traefik/traefik.toml:/traefik.toml
      # Docker socket access for automatic service discovery
      - /var/run/docker.sock:/var/run/docker.sock
    networks:
      - web

  #-----------------------------------------------------------------------------
  # NGINX - Gateway Landing Page
  #-----------------------------------------------------------------------------
  # Serves the main landing page with links to all services
  # Accessible at: http://home.mystic.home or http://mystic.home
  # Static files: HTML/CSS/JS implementation from separate repository
  #-----------------------------------------------------------------------------
  gateway:
    image: nginx:alpine
    container_name: gateway
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.gateway.rule=Host(`home.mystic.home`) || Host(`mystic.home`)"
      - "traefik.http.services.gateway.loadbalancer.server.port=80"
    expose:
      - "80"
    networks:
      - web
    volumes:
      # Static website files (HTML/CSS/JS from separate repo)
      # Place your gateway page implementation here
      - /data/docker/gateway/html:/usr/share/nginx/html:ro
      # Optional: Custom nginx configuration (uncomment if you have one)
      # - /data/docker/gateway/nginx.conf:/etc/nginx/nginx.conf:ro

  #-----------------------------------------------------------------------------
  # NEXTCLOUD - File Storage & Collaboration
  #-----------------------------------------------------------------------------
  # Self-hosted file sync and share platform
  # Accessible at: http://cloud.mystic.home
  # Database: MariaDB (mariadbone)
  # Default admin: mystic / password (CHANGE THIS!)
  #-----------------------------------------------------------------------------
  nextcloud:
    image: nextcloud:latest
    container_name: nextcloud
    restart: unless-stopped
    depends_on:
      - mariadbone
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.cloud.rule=Host(`cloud.mystic.home`)"
      - "traefik.http.services.cloud.loadbalancer.server.port=80"
    expose:
      - "80"
    networks:
      - web
    environment:
      # Initial admin account (created on first run)
      - NEXTCLOUD_ADMIN_USER=mystic
      - NEXTCLOUD_ADMIN_PASSWORD=password  # TODO: Change this!
      - NEXTCLOUD_TRUSTED_DOMAINS=cloud.mystic.home
      # Database connection settings
      - MYSQL_DATABASE=home
      - MYSQL_USER=mystic
      - MYSQL_PASSWORD=password  # TODO: Change this!
      - MYSQL_HOST=mariadbone
    volumes:
      # Nextcloud data and config (UID 33:33 required)
      - /data/docker/nextcloud:/var/www/html

  #-----------------------------------------------------------------------------
  # MARIADB - Database for Nextcloud
  #-----------------------------------------------------------------------------
  # MySQL-compatible database server
  # Used by: Nextcloud
  # Database: home
  #-----------------------------------------------------------------------------
  mariadbone:
    image: mariadb:latest
    container_name: mariadbone
    restart: unless-stopped
    environment:
      - MYSQL_USER=mystic
      - MYSQL_PASSWORD=password        # TODO: Change this!
      - MYSQL_DATABASE=home
      - MYSQL_ROOT_PASSWORD=password   # TODO: Change this!
    networks:
      - web
    volumes:
      # Database files (UID 999:999 required)
      - /data/docker/mariadbone:/var/lib/mysql

  #-----------------------------------------------------------------------------
  # JENKINS - Continuous Integration & Deployment
  #-----------------------------------------------------------------------------
  # Automation server for CI/CD pipelines
  # Accessible at: http://jenkins.mystic.home
  # Port 50000: Agent communication (required for build agents)
  # Initial admin password: check /var/jenkins_home/secrets/initialAdminPassword
  #-----------------------------------------------------------------------------
  jenkins:
    image: jenkins/jenkins:latest
    container_name: jenkins
    restart: unless-stopped
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.jenkins.rule=Host(`jenkins.mystic.home`)"
      - "traefik.http.services.jenkins.loadbalancer.server.port=8080"
    expose:
      - "8080"
    ports:
      - "50000:50000"  # JNLP agent port
    networks:
      web:
        aliases:
          - jenkins.mystic.home
    volumes:
      # Jenkins home directory (UID 1000:1000 required)
      - /data/docker/jenkins/:/var/jenkins_home

  #-----------------------------------------------------------------------------
  # BAMBOO - Build & Deployment Server
  #-----------------------------------------------------------------------------
  # Continuous integration and deployment server
  # Accessible at: http://bamboo.mystic.home
  # Database: PostgreSQL (postgresdbfive)
  # Port 54663: Remote agent communication
  # FIRST RUN: Configure database connection via web UI
  #   Host: postgresdbfive, Port: 5432, Database: home
  #   User: mystic, Password: password
  #-----------------------------------------------------------------------------
  bamboo:
    image: atlassian/bamboo:latest
    container_name: bamboo
    restart: unless-stopped
    depends_on:
      - postgresdbfive
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.bamboo.rule=Host(`bamboo.mystic.home`)"
      - "traefik.http.services.bamboo.loadbalancer.server.port=8085"
    expose:
      - "8085"
    ports:
      - "54663:54663"  # Remote agent port
    networks:
      web:
        aliases:
          - bamboo.mystic.home
    volumes:
      # Bamboo data directory (UID 2005:2005 required)
      - /data/docker/bamboo/:/var/atlassian/application-data/bamboo

  #-----------------------------------------------------------------------------
  # POSTGRESQL Instance 5 - Database for Bamboo
  #-----------------------------------------------------------------------------
  # PostgreSQL database server
  # Used by: Bamboo
  # Database: home
  #-----------------------------------------------------------------------------
  postgresdbfive:
    image: postgres:17.8-alpine
    container_name: postgresdbfive
    restart: unless-stopped
    environment:
      - POSTGRES_USER=mystic
      - POSTGRES_PASSWORD=password  # TODO: Change this!
      - POSTGRES_DB=home
    networks:
      - web
    volumes:
      # Database files (UID 999:999 required)
      - /data/docker/postgresdbfive:/var/lib/postgresql/data

  #-----------------------------------------------------------------------------
  # CONFLUENCE - Team Wiki & Documentation
  #-----------------------------------------------------------------------------
  # Collaborative workspace for documentation
  # Accessible at: http://confluence.mystic.home
  # Database: PostgreSQL (postgresdbone)
  # Port 8091: Synchrony (collaborative editing)
  # FIRST RUN: Configure database connection via web UI
  #   Host: postgresdbone, Port: 5432, Database: home
  #   User: mystic, Password: password
  #-----------------------------------------------------------------------------
  confluence:
    image: atlassian/confluence:latest
    container_name: confluence
    restart: unless-stopped
    depends_on:
      - postgresdbone
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.confluence.rule=Host(`confluence.mystic.home`)"
      - "traefik.http.services.confluence.loadbalancer.server.port=8090"
    expose:
      - "8090"
    ports:
      - "8091:8091"  # Synchrony collaborative editing
    networks:
      web:
        aliases:
          - confluence.mystic.home
    volumes:
      # Confluence data directory (UID 2002:2002 required)
      - /data/docker/confluence/:/var/atlassian/application-data/confluence

  #-----------------------------------------------------------------------------
  # POSTGRESQL Instance 1 - Database for Confluence
  #-----------------------------------------------------------------------------
  # PostgreSQL database server
  # Used by: Confluence
  # Database: home
  #-----------------------------------------------------------------------------
  postgresdbone:
    image: postgres:17.8-alpine
    container_name: postgresdbone
    restart: unless-stopped
    environment:
      - POSTGRES_USER=mystic
      - POSTGRES_PASSWORD=password  # TODO: Change this!
      - POSTGRES_DB=home
    networks:
      - web
    volumes:
      # Database files (UID 999:999 required)
      - /data/docker/postgresdbone:/var/lib/postgresql/data

  #-----------------------------------------------------------------------------
  # JIRA - Project & Issue Tracking
  #-----------------------------------------------------------------------------
  # Agile project management and issue tracking
  # Accessible at: http://jira.mystic.home
  # Database: PostgreSQL (postgresdbtwo)
  # FIRST RUN: Configure database connection via web UI
  #   Host: postgresdbtwo, Port: 5432, Database: home
  #   User: mystic, Password: password
  #-----------------------------------------------------------------------------
  jira:
    image: atlassian/jira-software:latest
    container_name: jira
    restart: unless-stopped
    depends_on:
      - postgresdbtwo
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.jira.rule=Host(`jira.mystic.home`)"
      - "traefik.http.services.jira.loadbalancer.server.port=8080"
    expose:
      - "8080"
    networks:
      web:
        aliases:
          - jira.mystic.home
    volumes:
      # Jira data directory (UID 2001:2001 required)
      - /data/docker/jira/:/var/atlassian/application-data/jira

  #-----------------------------------------------------------------------------
  # POSTGRESQL Instance 2 - Database for Jira
  #-----------------------------------------------------------------------------
  # PostgreSQL database server
  # Used by: Jira
  # Database: home
  #-----------------------------------------------------------------------------
  postgresdbtwo:
    image: postgres:17.8-alpine
    container_name: postgresdbtwo
    restart: unless-stopped
    environment:
      - POSTGRES_USER=mystic
      - POSTGRES_PASSWORD=password  # TODO: Change this!
      - POSTGRES_DB=home
    networks:
      - web
    volumes:
      # Database files (UID 999:999 required)
      - /data/docker/postgresdbtwo:/var/lib/postgresql/data

  #-----------------------------------------------------------------------------
  # BITBUCKET - Git Repository Management
  #-----------------------------------------------------------------------------
  # Self-hosted Git repository manager
  # Accessible at: http://bitbucket.mystic.home
  # Database: PostgreSQL (postgresdbthree)
  # Port 7999: SSH access for Git operations
  # FIRST RUN: Configure database connection via web UI
  #   Host: postgresdbthree, Port: 5432, Database: home
  #   User: mystic, Password: password
  #-----------------------------------------------------------------------------
  bitbucket:
    image: atlassian/bitbucket:latest
    container_name: bitbucket
    restart: unless-stopped
    depends_on:
      - postgresdbthree
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.bitbucket.rule=Host(`bitbucket.mystic.home`)"
      - "traefik.http.services.bitbucket.loadbalancer.server.port=7990"
    expose:
      - "7990"
    ports:
      - "7999:7999"  # SSH port for Git operations
    networks:
      web:
        aliases:
          - bitbucket.mystic.home
    volumes:
      # Bitbucket data directory (UID 2003:2003 required)
      - /data/docker/bitbucket/:/var/atlassian/application-data/bitbucket

  #-----------------------------------------------------------------------------
  # POSTGRESQL Instance 3 - Database for Bitbucket
  #-----------------------------------------------------------------------------
  # PostgreSQL database server
  # Used by: Bitbucket
  # Database: home
  #-----------------------------------------------------------------------------
  postgresdbthree:
    image: postgres:17.8-alpine
    container_name: postgresdbthree
    restart: unless-stopped
    environment:
      - POSTGRES_USER=mystic
      - POSTGRES_PASSWORD=password  # TODO: Change this!
      - POSTGRES_DB=home
    networks:
      - web
    volumes:
      # Database files (UID 999:999 required)
      - /data/docker/postgresdbthree:/var/lib/postgresql/data

  #-----------------------------------------------------------------------------
  # POSTGRESQL Instance 4 - Database for Mattermost (Hardened)
  #-----------------------------------------------------------------------------
  # PostgreSQL database server with enhanced security
  # Used by: Mattermost
  # Database: mattermost
  # Security: read-only filesystem, no new privileges, limited PIDs
  #-----------------------------------------------------------------------------
  postgresdbfour:
    image: postgres:17.8-alpine
    container_name: postgresdbfour
    restart: unless-stopped
    # Enhanced security settings
    security_opt:
      - no-new-privileges:true  # Prevent privilege escalation
    pids_limit: 100             # Limit number of processes
    read_only: true             # Read-only root filesystem
    tmpfs:
      # Writable temp directories (required for PostgreSQL)
      - /tmp
      - /var/run/postgresql
    volumes:
      # Database files (UID 999:999 required)
      - /data/docker/postgresdbfour:/var/lib/postgresql/data
    environment:
      - TZ=UTC
      - POSTGRES_USER=mystic
      - POSTGRES_PASSWORD=password  # TODO: Change this!
      - POSTGRES_DB=mattermost
    networks:
      - web

  #-----------------------------------------------------------------------------
  # MAIL SERVER - SMTP/IMAP Email Service
  #-----------------------------------------------------------------------------
  # Full-featured mail server with SMTP, IMAP, and anti-spam
  # Accessible at: https://mail.mystic.home (webmail via Roundcube/Rainloop)
  # SMTP: Port 25, 587 (submission), 465 (submissions)
  # IMAP: Port 993 (imaps)
  # POP3: Port 995 (pop3s)
  #
  # FIRST RUN SETUP:
  # 1. Configure DNS records (MX, SPF, DKIM, DMARC)
  # 2. Set hostname: export HOSTNAME=mail.mystic.home
  # 3. Create email accounts:
  #    docker exec -it mailserver setup email add user@mystic.home password
  # 4. Generate DKIM keys:
  #    docker exec -it mailserver setup config dkim
  #
  # NOTE: For development/testing, consider using Mailpit instead
  #       For production, proper DNS configuration is required
  #-----------------------------------------------------------------------------
  mailserver:
    image: mailserver/docker-mailserver:latest
    container_name: mailserver
    hostname: mail
    domainname: mystic.home
    restart: unless-stopped
    ports:
      # SMTP ports
      - "25:25"     # SMTP
      - "587:587"   # Submission
      # IMAP port (unencrypted — SSL is disabled)
      - "143:143"   # IMAP
      # Uncomment these when SSL_TYPE is configured:
      # - "465:465"   # SMTPS (SSL/TLS)
      # - "993:993"   # IMAPS (SSL/TLS)
      # - "995:995"   # POP3S (SSL/TLS)
    labels:
      # Mail traffic uses dedicated ports (25, 465, 587, 993, 995), not Traefik
      - "traefik.enable=false"
    networks:
      - web
    volumes:
      # Mail data and configuration
      - /data/docker/mailserver/mail-data:/var/mail:rw
      - /data/docker/mailserver/mail-state:/var/mail-state:rw
      - /data/docker/mailserver/mail-logs:/var/log/mail:rw
      - /data/docker/mailserver/config:/tmp/docker-mailserver:rw
      # SSL certificates (use Let's Encrypt certificates from Traefik)
      # - /data/docker/traefik/acme:/etc/letsencrypt:ro
    environment:
      # Basic configuration
      - ENABLE_SPAMASSASSIN=1
      - ENABLE_CLAMAV=0       # Disabled — requires ~1GB RAM, causes OOM crashes
      - ENABLE_FAIL2BAN=0     # Disabled — conflicts with no-new-privileges
      - ENABLE_POSTGREY=0
      # SSL/TLS
      - SSL_TYPE=             # Disabled for testing; use 'letsencrypt' for production
      # Other settings
      - ONE_DIR=1
      - DMS_DEBUG=0
      - PERMIT_DOCKER=network
    cap_add:
      - NET_ADMIN  # Required for Fail2Ban
    security_opt:
      - no-new-privileges:true

  #-----------------------------------------------------------------------------
  # MATTERMOST - Team Chat & Collaboration
  #-----------------------------------------------------------------------------
  # Open-source team communication platform
  # Accessible at: http://chat.mystic.home
  # Database: PostgreSQL (postgresdbfour)
  # NOTE: Routed via Traefik on HTTP (port 80) like all other services
  #-----------------------------------------------------------------------------
  mattermost:
    container_name: mattermost
    depends_on:
      - postgresdbfour
    image: mattermost/mattermost-enterprise-edition:latest
    restart: unless-stopped
    # Security settings
    security_opt:
      - no-new-privileges:true
    pids_limit: 200
    read_only: false  # Mattermost needs write access
    expose:
      - "8065"
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.mattermost.rule=Host(`chat.mystic.home`)"
      - "traefik.http.services.mattermost.loadbalancer.server.port=8065"
    tmpfs:
      - /tmp
    volumes:
      # All Mattermost data directories (UID 2000:2000 required)
      - /data/docker/mattermost/config:/mattermost/config:rw
      - /data/docker/mattermost/data:/mattermost/data:rw
      - /data/docker/mattermost/logs:/mattermost/logs:rw
      - /data/docker/mattermost/plugins:/mattermost/plugins:rw
      - /data/docker/mattermost/clientplugins:/mattermost/client/plugins:rw
      - /data/docker/mattermost/bleveindexes:/mattermost/bleve-indexes:rw
      # Optional: GitLab SSO certificate chain
      # Uncomment and set path if using GitLab SSO
      # - ${GITLAB_PKI_CHAIN_PATH}:/etc/ssl/certs/pki_chain.pem:ro
    environment:
      - TZ=UTC
      # Database connection
      - MM_SQLSETTINGS_DRIVERNAME=postgres
      - MM_SQLSETTINGS_DATASOURCE=postgres://mystic:password@postgresdbfour:5432/mattermost?sslmode=disable&connect_timeout=10
      # Search index location
      - MM_BLEVESETTINGS_INDEXDIR=/mattermost/bleve-indexes
      # Site URL (update for production)
      - MM_SERVICESETTINGS_SITEURL=http://chat.mystic.home
    networks:
      - web

  #-----------------------------------------------------------------------------
  # OLLAMA - Local LLM Inference Engine
  #-----------------------------------------------------------------------------
  # Runs large language models locally with GPU acceleration
  # API only — not web-facing (accessed by Open WebUI internally)
  # Requires NVIDIA GPU with Docker GPU support configured
  #-----------------------------------------------------------------------------
  ollama:
    image: ollama/ollama:latest
    container_name: ollama
    restart: unless-stopped
    labels:
      # API-only service — not routed through Traefik
      - "traefik.enable=false"
    networks:
      - web
    volumes:
      # Ollama model storage and config (UID 0:0 — runs as root)
      - /data/docker/ollama:/root/.ollama
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

  #-----------------------------------------------------------------------------
  # OPEN WEBUI - AI Chat Interface
  #-----------------------------------------------------------------------------
  # Web-based chat interface for interacting with local LLMs via Ollama
  # Accessible at: http://ai.mystic.home
  # Backend: Ollama (ollama:11434)
  # FIRST RUN: Create an admin account via the web UI
  #-----------------------------------------------------------------------------
  openwebui:
    image: ghcr.io/open-webui/open-webui:latest
    container_name: openwebui
    restart: unless-stopped
    depends_on:
      - ollama
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.openwebui.rule=Host(`ai.mystic.home`)"
      - "traefik.http.routers.openwebui.entrypoints=web"
      - "traefik.http.services.openwebui.loadbalancer.server.port=8080"
    networks:
      - web
    environment:
      - OLLAMA_BASE_URL=http://ollama:11434
      - WEBUI_SECRET_KEY=
    volumes:
      # Open WebUI data directory (UID 0:0 — runs as root)
      - /data/docker/openwebui:/app/backend/data

  #-----------------------------------------------------------------------------
  # ELASTICSEARCH - Search & Analytics Engine
  #-----------------------------------------------------------------------------
  # Distributed search and analytics engine for centralized logging
  # API only — not web-facing (accessed by Kibana and Logstash internally)
  # Part of the ELK stack (Elasticsearch, Logstash, Kibana)
  #-----------------------------------------------------------------------------
  elasticsearch:
    image: elasticsearch:9.3.0
    container_name: elasticsearch
    restart: unless-stopped
    labels:
      # API-only service — not routed through Traefik
      - "traefik.enable=false"
    environment:
      - discovery.type=single-node
      - xpack.security.enabled=false
      - ES_JAVA_OPTS=-Xms512m -Xmx512m
    networks:
      - web
    volumes:
      # Elasticsearch data directory (UID 1000:1000 required)
      - /data/docker/elasticsearch/data:/usr/share/elasticsearch/data

  #-----------------------------------------------------------------------------
  # LOGSTASH - Log Ingestion Pipeline
  #-----------------------------------------------------------------------------
  # Server-side data processing pipeline for log ingestion
  # Receives logs via Beats (5044), TCP (5010), and exposes monitoring (9600)
  # Part of the ELK stack (Elasticsearch, Logstash, Kibana)
  #-----------------------------------------------------------------------------
  logstash:
    image: logstash:9.3.0
    container_name: logstash
    restart: unless-stopped
    depends_on:
      - elasticsearch
    labels:
      # Not web-facing — uses dedicated ports for log ingestion
      - "traefik.enable=false"
    ports:
      - "5044:5044"       # Beats input
      - "5010:5010/tcp"   # Custom TCP input
      - "9600:9600"       # Monitoring API
    environment:
      - LS_JAVA_OPTS=-Xms256m -Xmx256m
    networks:
      - web
    volumes:
      # Logstash pipeline configuration (UID 1000:1000 required)
      - /data/docker/logstash/pipeline:/usr/share/logstash/pipeline:ro

  #-----------------------------------------------------------------------------
  # KIBANA - Log Visualization & Dashboards
  #-----------------------------------------------------------------------------
  # Web-based visualization platform for Elasticsearch data
  # Accessible at: http://kibana.mystic.home
  # Backend: Elasticsearch (elasticsearch:9200)
  # Part of the ELK stack (Elasticsearch, Logstash, Kibana)
  #-----------------------------------------------------------------------------
  kibana:
    image: kibana:9.3.0
    container_name: kibana
    restart: unless-stopped
    depends_on:
      - elasticsearch
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.kibana.rule=Host(`kibana.mystic.home`)"
      - "traefik.http.routers.kibana.entrypoints=web"
      - "traefik.http.services.kibana.loadbalancer.server.port=5601"
    environment:
      - ELASTICSEARCH_HOSTS=http://elasticsearch:9200
    networks:
      - web
    volumes:
      # Kibana saved objects, dashboards, and settings (UID 1000:1000 required)
      - /data/docker/kibana:/usr/share/kibana/data

################################################################################
# NETWORKS
################################################################################
# External network "web" must be created before starting services:
#   docker network create web
#
# All services connect to this shared network for:
# - Inter-service communication
# - Traefik service discovery
# - DNS resolution between containers
################################################################################
networks:
  web:
    external: true
